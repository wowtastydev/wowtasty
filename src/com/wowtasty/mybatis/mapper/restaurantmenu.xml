<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="restaurantmenu">

	<sql id="columns"> 
		RestaurantID,MenuID,CategoryID,Name,Price,Description,ImagePath,Sort,TaxRate,Status,MinUnit, NAFlag,UpdateID,UpdateTime
	</sql>
	
	<!--selectByRestaurant-->
	<select id="selectByRestaurant" parameterType="String" resultType="restaurantmenuvo">
	SELECT 
	<include refid="columns"/>
	FROM restaurant_menu 
	WHERE RestaurantID = #{restaurantID} 
	  AND NAFlag != 1
	ORDER BY Sort
	</select>
	
	<!--selectByID-->
	<select id="selectByID" parameterType="java.util.Map" resultType="restaurantmenuvo">
	SELECT 
	<include refid="columns"/>
	FROM restaurant_menu 
	WHERE RestaurantID = #{restaurantID} 
		  AND MenuID = #{menuID}
	</select>
	
	<!--selectMaxID-->
	<select id="selectMaxID" parameterType="String" resultType="Integer">
	SELECT 
		 IFNULL(MAX(MenuID)+1, 1)
	FROM restaurant_menu 
	WHERE RestaurantID = #{restaurantID} 
	</select>
	
	<!--Insert-->
	<insert id = "insert" parameterType="restaurantmenuvo">
	INSERT INTO restaurant_menu
	( 	
		<include refid="columns"/>
		)
	VALUES
	(	#{restaurantID},
		#{menuID},
		#{categoryID},
		TRIM(#{name}),
		#{price},
		TRIM(#{description}),
		TRIM(#{imagePath}),
		#{sort},
		#{taxRate},
		#{status},
		#{minUnit},
		#{naFlag},
		#{updateID},
		now())
	</insert>
	
	<!--Update-->
	<update id = "update" parameterType="restaurantmenuvo">
		UPDATE restaurant_menu
		SET CategoryID = #{categoryID},
			Name = TRIM(#{name}),
			Price = #{price},
			Description = TRIM(#{description}),
			ImagePath = TRIM(#{imagePath}),
			Sort = #{sort},
			TaxRate = #{taxRate},
			Status = #{status},
			MinUnit = #{minUnit},
			NAFlag = #{naFlag},
			UpdateID = #{updateID},
			UpdateTime = now() 
		WHERE RestaurantID = #{restaurantID} 
		  AND MenuID = #{menuID}
	</update>
	
	<!--Delete-->
	<update id = "delete" parameterType="restaurantmenuvo">
		UPDATE restaurant_menu
		SET NAFlag = #{naFlag}
		WHERE RestaurantID = #{restaurantID} 
		  AND MenuID = #{menuID}
	</update>
</mapper>